name: CI
on: [ push ]
jobs:
  building:
    runs-on: ubuntu-latest

    steps:
      - name: checkout
        uses: actions/checkout@master

      - name: build
        shell: bash
        run: |
          git submodule update --init --recursive
          cmake -B build
          cd build
          make
  testing:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@master

      - name: test
        shell: bash
        run: |
          git submodule update --init --recursive
          cmake -B build
          cd build
          make ./tests

      - name: install lcov and gcovr
        run: |
          sudo pip install --user cpp-coveralls
          pip install gcovr
          sudo apt-get install -y lcov

      - name: run gcovr
        run: |
          gcovr tests/test.cpp -o report

      - name: run lcov
        run: lcov --capture --directory . --output-file lcov.info

      - name: coveralls
        uses: coverallsapp/github-action@master
        with:
          path-to-lcov: "./lcov.info"
          github-token: ${{ secrets.github_token }}